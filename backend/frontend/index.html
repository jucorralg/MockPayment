<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mock Payment</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 40px; }
#paymentForm { background: #fff; padding: 20px; max-width: 400px; margin: auto; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
input { width: 100%; padding: 8px; margin: 8px 0; }
button { width: 100%; padding: 10px; background: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
button:disabled { background: #aaa; }
#confirmationBox { display:none; background: #d4edda; padding: 15px; margin-top: 20px; border-radius: 5px; }
</style>
</head>
<body>

<div id="paymentForm">
    <h2>Pay with MockPay</h2>
    <label>Amount (€)</label>
    <input type="number" id="amount" placeholder="Amount" />
    <label>Cardholder Name</label>
    <input type="text" id="cardName" placeholder="Name on card" />
    <label>Card Number</label>
    <input type="text" id="cardNumber" placeholder="Card number" />
    <label>Expiry (MM/YY)</label>
    <input type="text" id="expiry" placeholder="MM/YY" />
    <label>CVV</label>
    <input type="text" id="cvv" placeholder="CVV" />
    <button id="payButton" onclick="processPayment()">Pay Now</button>
</div>

<div id="confirmationBox">
    <div id="confirmationDetails"></div>
</div>

<script>
// Parse sessionId and amount from URL
const urlParams = new URLSearchParams(window.location.search);
const sessionId = urlParams.get('sessionId');
const prefillAmount = urlParams.get('amount');

if (prefillAmount) {
    document.getElementById('amount').value = prefillAmount;
}

// Generate fake confirmation code
function generateConfirmationCode() {
    return 'NP-' + Math.random().toString(36).substring(2, 10).toUpperCase();
}

// Process payment
async function processPayment() {
    const amount = document.getElementById("amount").value;
    const name = document.getElementById("cardName").value;
    const number = document.getElementById("cardNumber").value;
    const expiry = document.getElementById("expiry").value;
    const cvv = document.getElementById("cvv").value;
    const button = document.getElementById("payButton");

    if (!amount || !name || !number || !expiry || !cvv) {
        alert("Please complete all fields.");
        return;
    }

    button.disabled = true;
    button.innerHTML = "Processing...";

    try {
        const response = await fetch("http://localhost:3000/api/pay", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ sessionId, amount, cardNumber: number, cardName: name, expiry, cvv })
        });

        const data = await response.json();

        if (data.status === "success") {
            document.getElementById("confirmationDetails").innerHTML =
                `<strong>Amount:</strong> €${data.amount.toFixed(2)}<br>
                 <strong>Card:</strong> **** **** **** ${data.last4}<br>
                 <strong>Transaction ID:</strong> ${data.confirmationCode}<br>
                 <strong>Status:</strong> Completed`;

            document.getElementById("confirmationBox").style.display = "block";
            button.innerHTML = "Payment Completed";
        } else {
            alert("Payment failed.");
            button.disabled = false;
            button.innerHTML = "Pay Now";
        }

    } catch (err) {
        alert("Server error. Is backend running?");
        button.disabled = false;
        button.innerHTML = "Pay Now";
    }
}
</script>

</body>
</html>
